<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Recycle Islands VR - Plastic Island</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>

    <script src="../js/island.js"></script>
    <script src="../js/simple-grab.js"></script>
    <script src="../js/delete-on-contact.js"></script>
  </head>

  <body>
    <a-scene physics="gravity: -9.8; debug: false">
      <a-assets>
        <a-asset-item id="palmModel" src="../assets/textures/Trees/Palm.glb"></a-asset-item>
        <a-asset-item id="plasticItem1" src="../assets/plastic-trash/Bottle.glb"></a-asset-item>
        <a-asset-item id="plasticItem2" src="../assets/plastic-trash/Soda.glb"></a-asset-item>
        <a-asset-item id="plasticItem3" src="../assets/plastic-trash/bag.glb"></a-asset-item>
      </a-assets>

      <a-sky color="#87CEEB"></a-sky>

      <a-light type="point" color="#ffdca8" intensity="2" distance="500" position="0 20 0"></a-light>

      <a-entity id="player" movement-controls="fly: false; speed: 0.2">
        <a-camera position="0 0.5 0">
           <a-cursor raycaster="objects: .grabbable" color="yellow"></a-cursor>
        </a-camera>

        <a-entity
          id="left-hand"
          hand-controls="hand: left; modelStyle: highPoly"
          sphere-collider="objects: .grabbable; radius: 0.2"
          simple-grab>
        </a-entity>

        <a-entity
          id="right-hand"
          hand-controls="hand: right; modelStyle: highPoly"
          sphere-collider="objects: .grabbable; radius: 0.2"
          simple-grab>
        </a-entity>
      </a-entity>

      <a-cylinder
        id="bin"
        color="gray"
        height="1.5"
        radius="0.5"
        position="0 0 -5"
        static-body
        delete-on-contact
      ></a-cylinder>

      <a-box
        class="ground"
        position="0 -1 0"
        scale="60 60 1"
        rotation="-90 0 0"
        src="../assets/textures/Ground/Ground093C_1K-JPG/Ground093C_1K-JPG_Color.jpg"
        repeat="60 60"
        static-body
      >
      </a-box>

      <a-plane
        id="ocean"
        position="0 -1 0"
        width="1000"
        height="1000"
        rotation="-90 0 0"
        src="../assets/textures/Ground/Ice003_1K-JPG/Ice003_1K-JPG_Color.jpg"
        repeat="1000 1000"
        static-body
      >
      </a-plane>

      <a-entity id="welcomeText" position="0 3.5 -3">
        <a-text
          value="'Build your boat'"
          color="#000000"
          align="center"
          width="4"
          font="https://cdn.aframe.io/fonts/mozillavr.fnt"
        >
        </a-text>
      </a-entity>

      <script>
        const planeWidth = 45;
        const planeHeight = 45;
        const planeOffsetZ = 0;

        const addTrees = (count, scale) => {
           for (let i = 0; i < count; i++) {
            const tree = document.createElement("a-entity");
            tree.setAttribute("gltf-model", "#palmModel");
            tree.setAttribute("scale", `${scale} ${scale} ${scale}`);
            const x = Math.random() * planeWidth - planeWidth / 2;
            const z = Math.random() * planeHeight - planeHeight / 2 + planeOffsetZ;
            tree.setAttribute("position", `${x} -0.5 ${z}`);
            tree.setAttribute("rotation", `0 ${Math.random() * 360} 0`);
            document.querySelector("a-scene").appendChild(tree);
          }
        };

        addTrees(10, 2);
        addTrees(8, 2.5);
        addTrees(6, 3.5);
        addTrees(4, 4);
      </script>

      <script>
        const sandWidth = 55;
        const sandHeight = 55;
        const sandOffsetZ = 0;

        const createPlastic = (modelId, count, scale, yPos, rotationType) => {
          for (let i = 0; i < count; i++) {
            const plastic = document.createElement("a-entity");
            plastic.setAttribute("gltf-model", modelId);
            
            const x = Math.random() * sandWidth - sandWidth / 2;
            const z = Math.random() * sandHeight - sandHeight / 2 + sandOffsetZ;
            plastic.setAttribute("position", `${x} ${yPos} ${z}`);
            plastic.setAttribute("scale", scale);

            if (rotationType === 'random') {
              plastic.setAttribute("rotation", `0 ${Math.random() * 360} 0`);
            } else if (rotationType === 'lying') {
              plastic.setAttribute("rotation", `90 0 ${Math.random() * 360}`);
            }

            // CRITICAL: Must have 'grabbable' class
            plastic.setAttribute("class", "grabbable");
            
            // Physics
            plastic.setAttribute("dynamic-body", "mass: 0.2; shape: auto");

            document.querySelector("a-scene").appendChild(plastic);
          }
        };

        createPlastic("#plasticItem1", 55, "0.1 0.1 0.1", -0.4, 'lying');
        createPlastic("#plasticItem2", 70, "2 2 2", -0.4, 'random');
        createPlastic("#plasticItem3", 10, "3 3 3", -0.2, 'random');
      </script>

      <script>
        setTimeout(() => {
          const text = document.querySelector("#welcomeText");
          if (text) text.setAttribute("visible", false);
        }, 10000);
      </script>
    </a-scene>
  </body>
</html>